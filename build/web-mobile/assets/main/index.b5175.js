window.__require=function e(t,o,n){function r(a,s){if(!o[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,o,n)}return o[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<n.length;a++)r(n[a]);return r}({BoardManager:[function(e,t,o){"use strict";cc._RF.push(t,"866catP8WFBBpmOuUuQfbIH","BoardManager");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a,s=e("./GameConfig"),c=e("./ReelHandler"),l=e("./SlotMachine"),u=cc._decorator,p=u.ccclass,f=u.property;(function(){function e(){this.delayTimeToSpin=0}i([f()],e.prototype,"delayTimeToSpin",void 0),e=i([p("ReelConfig")],e)})(),function(e){e[e.START_SPIN=0]="START_SPIN",e[e.SPINNING=1]="SPINNING",e[e.STOP_SPIN=2]="STOP_SPIN",e[e.STOPPING=3]="STOPPING",e[e.STOPPED=4]="STOPPED",e[e.IDLE=5]="IDLE"}(a||(a={}));var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.reelLayout=null,t.reelPrefab=null,t.reels=[],t.currentBoardState=a.IDLE,t}var o;return r(t,e),o=t,t.getInstance=function(){return this.inst},t.prototype.onLoad=function(){o.inst=this},t.prototype.initReels=function(){for(var e=0;e<this.maxReels();e++){var t=cc.instantiate(this.reelPrefab);t.parent=this.reelLayout.node;var o=t.getComponent(c.default);o.init(e),this.reels.push(o)}this.reelLayout.updateLayout(),cc.tween(this.reelLayout.node).to(.25,{opacity:255}).start()},t.prototype.maxReels=function(){return s.GameConfig.NUM_VISIBLE_REELS},t.prototype.spinReels=function(){console.log("Spin Reels"),this.currentBoardState=a.START_SPIN},t.prototype.stopReels=function(){console.log("Stop Reels"),this.currentBoardState=a.STOP_SPIN},t.prototype.areAllReelsFullySpinning=function(){return this.reels.every(function(e){return e.isFullySpinning()})},t.prototype.areAllReelsIdling=function(){return this.reels.every(function(e){return e.isIdle()})},t.prototype.updateBoardState=function(){switch(this.currentBoardState){case a.START_SPIN:this.reels.forEach(function(e){e.startSpin()}),this.currentBoardState=a.SPINNING;break;case a.SPINNING:break;case a.STOP_SPIN:this.areAllReelsFullySpinning()&&(this.reels.forEach(function(e){e.stopSpin()}),this.currentBoardState=a.STOPPING);break;case a.STOPPING:this.areAllReelsIdling()&&(this.currentBoardState=a.STOPPED);break;case a.STOPPED:l.default.getInstance().spinButton.interactable=!0,this.currentBoardState=a.IDLE;break;case a.IDLE:}},t.prototype.update=function(){this.updateBoardState()},t.prototype.randomSymbol=function(){return s.GameConfig.AVAILABLE_SYMBOLS[Math.floor(Math.random()*s.GameConfig.AVAILABLE_SYMBOLS.length)]},t.inst=null,i([f(cc.Layout)],t.prototype,"reelLayout",void 0),i([f(cc.Prefab)],t.prototype,"reelPrefab",void 0),o=i([p],t)}(cc.Component);o.default=S,cc._RF.pop()},{"./GameConfig":"GameConfig","./ReelHandler":"ReelHandler","./SlotMachine":"SlotMachine"}],GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"40f95TpHtVH/abCXR7coZD/","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfig=void 0,o.GameConfig={TARGET_FPS:60,MAX_REEL_SPEED:50,NUM_VISIBLE_REELS:5,NUM_SYMBOLS_PER_REEL:3,SPIN_SPEED_INCREASE_STEP:2,STOP_ANIMATION_DURATION:.35,SYMBOLS_BUNDLE_NAME:"symbols",AVAILABLE_SYMBOLS:["1","2","3","4","5","6","7","8","K"],STOP_DELAY_WHEN_RECIEVE_RESPONSE:2e3,DELAY_TIME_ON_START:[0,.1,.2,.4,.6],DELAY_TIME_ON_STOP:[0,.1,.2,.4,.6]},cc._RF.pop()},{}],ReelHandler:[function(e,t,o){"use strict";cc._RF.push(t,"d12d336NkNCMb01AfsHle98","ReelHandler");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,r++)n[r]=i[a];return n};Object.defineProperty(o,"__esModule",{value:!0});var s,c=e("./BoardManager"),l=e("./GameConfig"),u=e("./SlotMachine"),p=e("./SymbolHandler"),f=cc._decorator,S=f.ccclass,d=f.property;(function(e){e[e.IDLE=0]="IDLE",e[e.START_SPIN=1]="START_SPIN",e[e.SPINNING=2]="SPINNING",e[e.MAP_SYMBOL=3]="MAP_SYMBOL",e[e.STOP_SPIN=4]="STOP_SPIN",e[e.STOPPING=5]="STOPPING"})(s||(s={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.symbolPrefab=null,t.reelIndex=0,t.spinSpeed=0,t.symbols=[],t.reservedSymbols=[],t.currentReelState=s.IDLE,t}return r(t,e),t.prototype.init=function(e){this.reelIndex=e;for(var t=0;t<l.GameConfig.NUM_SYMBOLS_PER_REEL+1;t++){var o=this.createSymbol(t);this.symbols.push(o)}for(t=0;t<l.GameConfig.NUM_SYMBOLS_PER_REEL;t++)(o=this.createSymbol(t)).node.opacity=0,this.reservedSymbols.push(o);this.node.height=this.symbols[0].node.height*l.GameConfig.NUM_SYMBOLS_PER_REEL},t.prototype.createSymbol=function(e){var t=cc.instantiate(this.symbolPrefab),o=t.getComponent(p.default);return o.init(e),t.parent=this.node,o},t.prototype.setSymbolYByIndex=function(e,t){e.y=-e.height/2-t*e.height},t.prototype.setReelIndex=function(e){this.reelIndex=e},t.prototype.isIdle=function(){return this.currentReelState===s.IDLE},t.prototype.isFullySpinning=function(){return this.currentReelState===s.SPINNING},t.prototype.startSpin=function(){this.spinSpeed=0,this.currentReelState=s.START_SPIN},t.prototype.stopSpin=function(){this.currentReelState=s.MAP_SYMBOL},t.prototype.getResultSymbols=function(){for(var e=c.default.getInstance().maxReels(),t=u.default.getInstance().currentSpinInfo,o=[],n=0;n<3;n++)o.push(t[this.reelIndex+n*e]);return o},t.prototype.update=function(e){this.updateSpin(e)},t.prototype.updateSpin=function(e){var t=this;switch(this.currentReelState){case s.START_SPIN:setTimeout(function(){t.currentReelState=s.SPINNING},1e3*l.GameConfig.DELAY_TIME_ON_START[this.reelIndex]);break;case s.SPINNING:var o=a(this.symbols);this.symbols.forEach(function(n){t.spinSpeed===l.GameConfig.MAX_REEL_SPEED&&n.getComponent(p.default).setBlur(!0),n.node.y-=t.spinSpeed*e*l.GameConfig.TARGET_FPS,n.node.y<=-t.node.height-n.node.height/2&&(n.node.y=t.symbols[0].node.y+n.node.height,o.unshift(o.pop()))}),this.symbols=o,this.spinSpeed+=l.GameConfig.SPIN_SPEED_INCREASE_STEP*e*l.GameConfig.TARGET_FPS,this.spinSpeed>=l.GameConfig.MAX_REEL_SPEED&&(this.spinSpeed=l.GameConfig.MAX_REEL_SPEED);break;case s.MAP_SYMBOL:console.log("Map Symbols");var n=this.getResultSymbols();this.reservedSymbols.forEach(function(e,t){e.setSymbol(n[t])}),this.currentReelState=s.SPINNING,setTimeout(function(){t.currentReelState=s.STOP_SPIN},1e3*l.GameConfig.DELAY_TIME_ON_STOP[this.reelIndex]);break;case s.STOP_SPIN:this.symbols.forEach(function(e,t){e.setBlur(!1);var o=e.getSymbolYByIndex(t+l.GameConfig.NUM_SYMBOLS_PER_REEL);cc.tween(e.node).to(l.GameConfig.STOP_ANIMATION_DURATION,{y:o},{easing:"backOut"}).start()}),this.reservedSymbols.forEach(function(e,t){e.setBlur(!1);var o=e.getSymbolYByIndex(t);e.node.y=o+l.GameConfig.NUM_SYMBOLS_PER_REEL*e.node.height,e.node.opacity=255,cc.tween(e.node).to(l.GameConfig.STOP_ANIMATION_DURATION,{y:o},{easing:"backOut"}).start()}),this.currentReelState=s.STOPPING,setTimeout(function(){var e=t.symbols.pop(),o=a(t.symbols);t.symbols=t.reservedSymbols,t.symbols.push(e),t.reservedSymbols=o,t.reservedSymbols.forEach(function(e,t){e.symbolIndex=t,e.node.opacity=0}),t.currentReelState=s.IDLE},1e3*l.GameConfig.STOP_ANIMATION_DURATION);break;case s.STOPPING:case s.IDLE:}},i([d(cc.Prefab)],t.prototype,"symbolPrefab",void 0),i([S],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./BoardManager":"BoardManager","./GameConfig":"GameConfig","./SlotMachine":"SlotMachine","./SymbolHandler":"SymbolHandler"}],ResourceManager:[function(e,t,o){"use strict";cc._RF.push(t,"f7dc3GCJ4hOdL8kayNpseg7","ResourceManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.ResourceManager=void 0;var n=e("./GameConfig"),r=function(){function e(){}return e.loadSymbolAssetBundle=function(){var e=this;return new Promise(function(t,o){cc.assetManager.loadBundle(n.GameConfig.SYMBOLS_BUNDLE_NAME,function(n,r){n&&(alert("Error while loading symbol bundle, please retry later."),location.reload(),o()),r.loadDir("/",cc.SpriteFrame,function(o,n){n.forEach(function(t){e.symbolSpriteFrameCollection[t.name]=t}),t()})})})},e.getSymbolSprite=function(e){return this.symbolSpriteFrameCollection[e]},e.symbolSpriteFrameCollection={},e}();o.ResourceManager=r,cc._RF.pop()},{"./GameConfig":"GameConfig"}],Server:[function(e,t,o){"use strict";cc._RF.push(t,"80dcbbgqylMar8eTAJ3kAPQ","Server"),Object.defineProperty(o,"__esModule",{value:!0});var n=[["1","2","3","4","5","6","7","K","1","2","3","4","5","6","7"],["1","2","6","2","1","6","4","K","5","2","8","3","3","3","3"],["1","2","6","3","4","7","K","K","K","1","3","5","2","4","2"],["1","2","3","4","3","5","3","8","3","1","5","3","4","5","7"],["2","7","3","2","3","8","7","3","K","1","5","3","4","6","5"],["2","7","3","K","6","8","5","2","K","1","5","3","4","5","8"]],r=function(){function e(){this._dataRespondCallbacks=[]}return e.prototype.registerDataRespondEvent=function(e){this._dataRespondCallbacks.push(e)},e.prototype.requestSpinData=function(){var e=this;window.setTimeout(function(){var t=e._randomRange(0,n.length-1,!0),o=[];Object.assign(o,n[t]),e._dataRespondCallbacks.forEach(function(e){e(o)})},100)},e.prototype._randomRange=function(e,t,o){void 0===o&&(o=!1);var n=t-e,r=e+Math.random()*n;return o&&(r=Math.round(r)),r},e}();o.default=r,cc._RF.pop()},{}],SlotMachine:[function(e,t,o){"use strict";cc._RF.push(t,"e7e493o9qBM3oCxrim/uikF","SlotMachine");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./BoardManager"),s=e("./GameConfig"),c=e("./ResourceManager"),l=e("./Server"),u=cc._decorator,p=u.ccclass,f=u.property,S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loadingNode=null,t.spinButton=null,t.startTime=0,t.server=new l.default,t.currentSpinInfo=[],t}var o;return r(t,e),o=t,t.getInstance=function(){return this.inst},t.prototype.onLoad=function(){var e=this;o.inst=this,this.server.registerDataRespondEvent(this.onReceivedResponse.bind(this)),c.ResourceManager.loadSymbolAssetBundle().then(function(){a.default.getInstance().initReels(),e.loadingNode.active=!1,e.spinButton.interactable=!0})},t.prototype.onSpin=function(){this.startTime=Date.now(),this.server.requestSpinData(),a.default.getInstance().spinReels(),this.spinButton.interactable=!1},t.prototype.onReceivedResponse=function(e){this.currentSpinInfo=e;var t=Date.now()-this.startTime,o=function(){a.default.getInstance().stopReels()};t>=s.GameConfig.STOP_DELAY_WHEN_RECIEVE_RESPONSE?o():setTimeout(function(){o()},s.GameConfig.STOP_DELAY_WHEN_RECIEVE_RESPONSE-t)},t.inst=null,i([f(cc.Node)],t.prototype,"loadingNode",void 0),i([f(cc.Button)],t.prototype,"spinButton",void 0),o=i([p],t)}(cc.Component);o.default=S,cc._RF.pop()},{"./BoardManager":"BoardManager","./GameConfig":"GameConfig","./ResourceManager":"ResourceManager","./Server":"Server"}],SymbolHandler:[function(e,t,o){"use strict";cc._RF.push(t,"e089e0mbfpJGLQ19RhZV/xt","SymbolHandler");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./BoardManager"),s=e("./ResourceManager"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.symbolIndex=-1,t.isBlur=!1,t.normalSpriteFrame=null,t.blurSpriteFrame=null,t}return r(t,e),t.prototype.init=function(e){this.symbolIndex=e,this.setRandomSymbol(!1),this.node.x=0,this.node.y=this.getSymbolYByIndex(this.symbolIndex)},t.prototype.getSymbolYByIndex=function(e){return-this.node.height/2-e*this.node.height},t.prototype.setSymbol=function(e){this.normalSpriteFrame=s.ResourceManager.getSymbolSprite("symbol_"+e),this.blurSpriteFrame=s.ResourceManager.getSymbolSprite("symbol_"+e+"_blur"),this.updateSpriteFrame()},t.prototype.setRandomSymbol=function(e){this.setBlur(e,!1),this.setSymbol(a.default.getInstance().randomSymbol())},t.prototype.setBlur=function(e,t){void 0===t&&(t=!0),this.isBlur!==e&&(this.isBlur=e,t&&this.updateSpriteFrame())},t.prototype.updateSpriteFrame=function(){this.sprite.spriteFrame=this.isBlur?this.blurSpriteFrame:this.normalSpriteFrame},i([u(cc.Sprite)],t.prototype,"sprite",void 0),i([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./BoardManager":"BoardManager","./ResourceManager":"ResourceManager"}]},{},["BoardManager","GameConfig","ReelHandler","ResourceManager","Server","SlotMachine","SymbolHandler"]);