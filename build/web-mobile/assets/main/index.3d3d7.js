window.__require=function e(t,o,n){function r(a,s){if(!o[a]){if(!t[a]){var p=a.split("/");if(p=p[p.length-1],!t[p]){var l="function"==typeof __require&&__require;if(!s&&l)return l(p,!0);if(i)return i(p,!0);throw new Error("Cannot find module '"+a+"'")}a=p}var c=o[a]={exports:{}};t[a][0].call(c.exports,function(e){return r(t[a][1][e]||e)},c,c.exports,e,t,o,n)}return o[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<n.length;a++)r(n[a]);return r}({BoardManager:[function(e,t,o){"use strict";cc._RF.push(t,"866catP8WFBBpmOuUuQfbIH","BoardManager");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a,s=e("./GameConfig"),p=e("./ReelHandler"),l=e("./SlotMachine"),c=cc._decorator,u=c.ccclass,f=c.property,y=function(){function e(){this.delayTimeToSpin=0}return i([f()],e.prototype,"delayTimeToSpin",void 0),i([u("ReelConfig")],e)}();(function(e){e[e.SPIN=0]="SPIN",e[e.SPINING=1]="SPINING",e[e.STOP=2]="STOP",e[e.STOPPING=3]="STOPPING",e[e.IDLE=4]="IDLE"})(a||(a={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.reelLayout=null,t.reelPrefab=null,t.reelConfig=[],t.reels=[],t.state=a.IDLE,t.currentSpinData=[],t}var o;return r(t,e),o=t,t.getInstance=function(){return this.inst},t.prototype.onLoad=function(){o.inst=this},t.prototype.initReels=function(){for(var e=0;e<this.maxReels();e++){var t=cc.instantiate(this.reelPrefab);t.parent=this.reelLayout.node;var o=t.getComponent(p.default);o.delayToSpinTime=this.reelConfig[e].delayTimeToSpin,o.setReelIndex(e),this.reels.push(o)}this.reelLayout.updateLayout(),cc.tween(this.reelLayout.node).to(.25,{opacity:255}).start()},t.prototype.maxReels=function(){return this.reelConfig.length},t.prototype.spinReels=function(){console.log("Spin Reels"),this.state=a.SPIN},t.prototype.stopReels=function(e){console.log("Stop Reels"),this.currentSpinData=e,this.state=a.STOP},t.prototype.isAllReelFullySpinning=function(){return this.reels.every(function(e){return e.isFullySpinning()})},t.prototype.update=function(){var e=this;switch(this.state){case a.SPIN:this.reels.forEach(function(e){return e.startSpin()}),this.state=a.SPINING;break;case a.SPINING:break;case a.STOP:this.isAllReelFullySpinning()&&(this.reels.forEach(function(t){t.stopSpin(e.getSymbolsForReel(e.currentSpinData,t.reelIndex))}),this.state=a.STOPPING);break;case a.STOPPING:this.reels.every(function(e){return e.isReady()})&&(this.state=a.IDLE,l.default.getInstance().spinButton.interactable=!0);break;case a.IDLE:}},t.prototype.getSymbolsForReel=function(e,t){for(var o=this.maxReels(),n=[],r=0;r<3;r++)n.push(e[t+r*o]);return n.push("Random"),n},t.prototype.randomSymbol=function(){return s.GameConfig.AVAILABLE_SYMBOLS[Math.floor(Math.random()*s.GameConfig.AVAILABLE_SYMBOLS.length)]},t.inst=null,i([f(cc.Layout)],t.prototype,"reelLayout",void 0),i([f(cc.Prefab)],t.prototype,"reelPrefab",void 0),i([f([y])],t.prototype,"reelConfig",void 0),o=i([u],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./GameConfig":"GameConfig","./ReelHandler":"ReelHandler","./SlotMachine":"SlotMachine"}],GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"40f95TpHtVH/abCXR7coZD/","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfig=void 0,o.GameConfig={TARGET_FPS:60,MAX_REEL_SPEED:50,MAX_ROWS_PER_REEL:3,SPIN_SPEED_INCREASE_STEP:1,STOP_ANIMATION_DURATION:.4,SYMBOLS_BUNBLE_NAME:"symbols",AVAILABLE_SYMBOLS:["1","2","3","4","5","6","7","8","K"],DELAY_TIME:2e3},cc._RF.pop()},{}],ReelHandler:[function(e,t,o){"use strict";cc._RF.push(t,"d12d336NkNCMb01AfsHle98","ReelHandler");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a,s=e("./GameConfig"),p=e("./SymbolHandler"),l=cc._decorator,c=l.ccclass,u=l.property,f=(a=cc.Node,r(function(){var e=null!==a&&a.apply(this,arguments)||this;return e.stopping=!1,e.symbolComp=null,e},a),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.reelIndex=0,t.symbolPrefab=null,t.delayToSpinTime=0,t.delayToSpinCount=0,t.spinSpeed=0,t.symbols=[],t.originalYPosition=[],t.tailSymbol=null,t.isSpinning=!1,t.isStopping=!1,t.symbolStopCount=0,t.stopBufferBetweenReelCount=0,t.finalSymbols=null,t}return r(t,e),t.prototype.start=function(){for(var e=0;e<s.GameConfig.MAX_ROWS_PER_REEL+1;e++){var t=cc.instantiate(this.symbolPrefab);t.x=0,t.stopping=!1,t.symbolComp=t.getComponent(p.default),t.y=-t.height/2-e*t.height,t.parent=this.node,t.symbolComp.setRandomSymbol(!1),this.symbols.push(t),this.originalYPosition.push(t.y)}this.node.height=this.symbols[0].height*s.GameConfig.MAX_ROWS_PER_REEL,this.tailSymbol=this.symbols[0]},t.prototype.setReelIndex=function(e){this.reelIndex=e},t.prototype.isReady=function(){return!this.isSpinning&&!this.isStopping},t.prototype.startSpin=function(){this.spinSpeed=0,this.delayToSpinCount=this.delayToSpinTime,this.isSpinning=!0},t.prototype.stopSpin=function(e){this.isStopping=!0,this.symbolStopCount=s.GameConfig.MAX_ROWS_PER_REEL+1,this.stopBufferBetweenReelCount=this.delayToSpinTime,this.finalSymbols=e},t.prototype.isFullySpinning=function(){return this.isSpinning&&this.delayToSpinCount<=0},t.prototype.update=function(e){var t=this;this.isSpinning&&this.symbols.forEach(function(o){if(t.delayToSpinCount>=0)t.delayToSpinCount-=e;else if(t.stopBufferBetweenReelCount>0&&(t.stopBufferBetweenReelCount-=e),o.stopping||(o.symbolComp.setBlur(!0),o.y-=t.spinSpeed*e*s.GameConfig.TARGET_FPS),t.spinSpeed+=s.GameConfig.SPIN_SPEED_INCREASE_STEP*e*s.GameConfig.TARGET_FPS,t.spinSpeed>=s.GameConfig.MAX_REEL_SPEED&&(t.spinSpeed=s.GameConfig.MAX_REEL_SPEED),!o.stopping&&o.y<=-t.node.height-o.height/2&&(o.y=t.tailSymbol.y+o.height,t.tailSymbol=o,t.delayToSpinCount<=0&&t.isStopping&&t.stopBufferBetweenReelCount<=0&&!o.stopping)){o.stopping=!0,o.symbolComp.setBlur(!1,!1),o.symbolComp.setSymbol(t.finalSymbols.pop());var n=t.originalYPosition[t.symbolStopCount-1];t.symbolStopCount===s.GameConfig.MAX_ROWS_PER_REEL+1&&(n=t.originalYPosition[0]+o.height,o.y=n+o.height),cc.tween(o).to(s.GameConfig.STOP_ANIMATION_DURATION,{y:n},{easing:"backOut"}).call(function(){t.isStopping&&(t.isStopping=!1,t.isSpinning=!1),o.stopping=!1}).start(),t.symbolStopCount-=1}})},i([u(cc.Prefab)],t.prototype,"symbolPrefab",void 0),i([c],t)}(cc.Component));o.default=f,cc._RF.pop()},{"./GameConfig":"GameConfig","./SymbolHandler":"SymbolHandler"}],ResourceManager:[function(e,t,o){"use strict";cc._RF.push(t,"f7dc3GCJ4hOdL8kayNpseg7","ResourceManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.ResourceManager=void 0;var n=e("./GameConfig"),r=function(){function e(){}return e.loadSymbolAssetBundle=function(){var e=this;return new Promise(function(t){cc.assetManager.loadBundle(n.GameConfig.SYMBOLS_BUNBLE_NAME,function(o,n){if(o)return alert("Error while loading symbol bundle, please retry later."),void location.reload();n.loadDir("/",cc.SpriteFrame,function(o,n){n.forEach(function(t){e.symbolSpriteFrameCollection[t.name]=t}),t()})})})},e.getSymbolSprite=function(e){return this.symbolSpriteFrameCollection[e]},e.symbolSpriteFrameCollection={},e}();o.ResourceManager=r,cc._RF.pop()},{"./GameConfig":"GameConfig"}],Server:[function(e,t,o){"use strict";cc._RF.push(t,"80dcbbgqylMar8eTAJ3kAPQ","Server"),Object.defineProperty(o,"__esModule",{value:!0});var n=[["1","2","3","4","5","6","7","K","1","2","3","4","5","6","7"],["1","2","6","2","1","6","4","K","5","2","8","3","3","3","3"],["1","2","6","3","4","7","K","K","K","1","3","5","2","4","2"],["1","2","3","4","3","5","3","8","3","1","5","3","4","5","7"],["2","7","3","2","3","8","7","3","K","1","5","3","4","6","5"],["2","7","3","K","6","8","5","2","K","1","5","3","4","5","8"]],r=function(){function e(){this._dataRespondCallbacks=[]}return e.prototype.registerDataRespondEvent=function(e){this._dataRespondCallbacks.push(e)},e.prototype.requestSpinData=function(){var e=this;window.setTimeout(function(){var t=e._randomRange(0,n.length-1,!0),o=[];Object.assign(o,n[t]),e._dataRespondCallbacks.forEach(function(e){e(o)})},100)},e.prototype._randomRange=function(e,t,o){void 0===o&&(o=!1);var n=t-e,r=e+Math.random()*n;return o&&(r=Math.round(r)),r},e}();o.default=r,cc._RF.pop()},{}],SlotMachine:[function(e,t,o){"use strict";cc._RF.push(t,"e7e493o9qBM3oCxrim/uikF","SlotMachine");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./BoardManager"),s=e("./GameConfig"),p=e("./ResourceManager"),l=e("./Server"),c=cc._decorator,u=c.ccclass,f=c.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loadingNode=null,t.spinButton=null,t.startTime=0,t.server=new l.default,t}var o;return r(t,e),o=t,t.getInstance=function(){return this.inst},t.prototype.onLoad=function(){var e=this;o.inst=this,this.server.registerDataRespondEvent(this.onSpinFinishResponse.bind(this)),p.ResourceManager.loadSymbolAssetBundle().then(function(){a.default.getInstance().initReels(),e.loadingNode.active=!1,e.spinButton.interactable=!0})},t.prototype.onSpin=function(){this.startTime=Date.now(),this.server.requestSpinData(),a.default.getInstance().spinReels(),this.spinButton.interactable=!1},t.prototype.onSpinFinishResponse=function(e){var t=Date.now()-this.startTime,o=function(){a.default.getInstance().stopReels(e)};t>=s.GameConfig.DELAY_TIME?o():setTimeout(function(){o()},s.GameConfig.DELAY_TIME-t)},t.inst=null,i([f(cc.Node)],t.prototype,"loadingNode",void 0),i([f(cc.Button)],t.prototype,"spinButton",void 0),o=i([u],t)}(cc.Component);o.default=y,cc._RF.pop()},{"./BoardManager":"BoardManager","./GameConfig":"GameConfig","./ResourceManager":"ResourceManager","./Server":"Server"}],SymbolHandler:[function(e,t,o){"use strict";cc._RF.push(t,"e089e0mbfpJGLQ19RhZV/xt","SymbolHandler");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=e("./BoardManager"),s=e("./ResourceManager"),p=cc._decorator,l=p.ccclass,c=p.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.isBlur=!1,t.normalSpriteFrame=null,t.blurSpriteFrame=null,t}return r(t,e),t.prototype.setBlur=function(e,t){void 0===t&&(t=!0),this.isBlur!==e&&(this.isBlur=e,t&&this.updateSpriteFrame())},t.prototype.updateSpriteFrame=function(){this.sprite.spriteFrame=this.isBlur?this.blurSpriteFrame:this.normalSpriteFrame},t.prototype.setSymbol=function(e){if("Random"===e)return this.setRandomSymbol(!1);this.normalSpriteFrame=s.ResourceManager.getSymbolSprite("symbol_"+e),this.blurSpriteFrame=s.ResourceManager.getSymbolSprite("symbol_"+e+"_blur"),this.updateSpriteFrame()},t.prototype.setRandomSymbol=function(e){this.setBlur(e,!1),this.setSymbol(a.default.getInstance().randomSymbol())},i([c(cc.Sprite)],t.prototype,"sprite",void 0),i([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./BoardManager":"BoardManager","./ResourceManager":"ResourceManager"}]},{},["BoardManager","GameConfig","ReelHandler","ResourceManager","Server","SlotMachine","SymbolHandler"]);