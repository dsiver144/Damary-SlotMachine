window.__require=function t(e,o,n){function i(s,p){if(!o[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var a="function"==typeof __require&&__require;if(!p&&a)return a(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var l=o[s]={exports:{}};e[s][0].call(l.exports,function(t){return i(e[s][1][t]||t)},l,l.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({GameConfig:[function(t,e,o){"use strict";cc._RF.push(e,"40f95TpHtVH/abCXR7coZD/","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.AVAILABLE_SYMBOLS=o.GAME_EVENT=o.SYMBOLS_BUNBLE_NAME=o.STOP_ANIMATION_DURATION=o.SPIN_SPEED_INCREASE_STEP=o.MAX_ROWS_PER_REEL=o.MAX_REEL_SPEED=o.TARGET_FPS=void 0,o.TARGET_FPS=60,o.MAX_REEL_SPEED=50,o.MAX_ROWS_PER_REEL=3,o.SPIN_SPEED_INCREASE_STEP=1,o.STOP_ANIMATION_DURATION=.4,o.SYMBOLS_BUNBLE_NAME="symbols",function(t){t.SPIN="Spin",t.READY="Ready",t.STOP="Stop",t.FINISH="Finish"}(o.GAME_EVENT||(o.GAME_EVENT={})),o.AVAILABLE_SYMBOLS=["1","2","3","4","5","6","7","8","K"],cc._RF.pop()},{}],GameManager:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","GameManager");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var p=t.length-1;p>=0;p--)(i=t[p])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./Server"),p=t("./GameConfig"),c=cc._decorator,a=c.ccclass,l=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spinButton=null,e.server=new s.default,e}return i(e,t),e.prototype.start=function(){this.server.registerDataRespondEvent(this.onSpinFinishResponse.bind(this)),cc.systemEvent.on(p.GAME_EVENT.READY,this.onReadyToSpin,this),cc.systemEvent.on(p.GAME_EVENT.FINISH,this.onSpinAnimationFinish,this)},e.prototype.onSpinFinishResponse=function(t){cc.systemEvent.emit(p.GAME_EVENT.STOP,t)},e.prototype.onReadyToSpin=function(){this.spinButton.interactable=!0},e.prototype.onSpinButton=function(){this.spinButton.interactable&&(this.spinButton.interactable=!1,this.server.requestSpinData(),cc.systemEvent.emit(p.GAME_EVENT.SPIN))},e.prototype.onSpinAnimationFinish=function(){this.spinButton.interactable=!0},r([l(cc.Button)],e.prototype,"spinButton",void 0),r([a],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./GameConfig":"GameConfig","./Server":"Server"}],Reel:[function(t,e,o){"use strict";cc._RF.push(e,"fdb7eJi9LBIB4j8KbYuqfWo","Reel");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var p=t.length-1;p>=0;p--)(i=t[p])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s,p=t("./GameConfig"),c=t("./Symbol"),a=cc._decorator,l=a.ccclass,u=a.property,f=(s=cc.Node,i(function(){var t=null!==s&&s.apply(this,arguments)||this;return t.stopping=!1,t.symbolComp=null,t},s),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.reelIndex=0,e.symbolPrefab=null,e.delayToSpinTime=0,e.delayToSpinCount=0,e.spinSpeed=0,e.symbols=[],e.originalYPosition=[],e.tailSymbol=null,e.isSpinning=!1,e.isStopping=!1,e.symbolStopCount=0,e.stopBufferBetweenReelCount=0,e.finalSymbols=null,e}return i(e,t),e.prototype.start=function(){for(var t=0;t<p.MAX_ROWS_PER_REEL+1;t++){var e=cc.instantiate(this.symbolPrefab);e.x=0,e.stopping=!1,e.symbolComp=e.getComponent(c.default),e.y=-e.height/2-t*e.height,e.parent=this.node,e.symbolComp.setRandomSymbol(!1),this.symbols.push(e),this.originalYPosition.push(e.y)}this.node.height=this.symbols[0].height*p.MAX_ROWS_PER_REEL,this.tailSymbol=this.symbols[0]},e.prototype.setReelIndex=function(t){this.reelIndex=t},e.prototype.isBusy=function(){return this.isSpinning||this.isStopping},e.prototype.startSpin=function(){this.spinSpeed=0,this.delayToSpinCount=this.delayToSpinTime,this.isSpinning=!0},e.prototype.stop=function(t){this.isStopping=!0,this.symbolStopCount=p.MAX_ROWS_PER_REEL+1,this.stopBufferBetweenReelCount=this.delayToSpinTime,this.finalSymbols=t},e.prototype.update=function(t){var e=this;this.isSpinning&&this.symbols.forEach(function(o){if(!e.isStopping&&e.delayToSpinCount>0)e.delayToSpinCount-=t;else if(e.stopBufferBetweenReelCount>0&&(e.stopBufferBetweenReelCount-=t),o.stopping||(o.symbolComp.getBlur()||o.symbolComp.setBlur(!0),o.y-=e.spinSpeed*t*p.TARGET_FPS),e.spinSpeed+=p.SPIN_SPEED_INCREASE_STEP*t*p.TARGET_FPS,e.spinSpeed>=p.MAX_REEL_SPEED&&(e.spinSpeed=p.MAX_REEL_SPEED),!o.stopping&&o.y<=-e.node.height-o.height/2&&(o.y=e.tailSymbol.y+o.height,e.tailSymbol=o,e.isStopping&&e.stopBufferBetweenReelCount<=0&&!o.stopping)){o.stopping=!0,o.symbolComp.setSymbol(e.finalSymbols.pop()),o.symbolComp.setBlur(!1);var n=e.originalYPosition[e.symbolStopCount-1];e.symbolStopCount===p.MAX_ROWS_PER_REEL+1&&(n=e.originalYPosition[0]+o.height,o.y=n+o.height),cc.tween(o).to(p.STOP_ANIMATION_DURATION,{y:n},{easing:"backOut"}).call(function(){e.isStopping&&(e.isStopping=!1,e.isSpinning=!1),o.stopping=!1}).start(),e.symbolStopCount-=1}})},r([u(cc.Prefab)],e.prototype,"symbolPrefab",void 0),r([l],e)}(cc.Component));o.default=f,cc._RF.pop()},{"./GameConfig":"GameConfig","./Symbol":"Symbol"}],Server:[function(t,e,o){"use strict";cc._RF.push(e,"80dcbbgqylMar8eTAJ3kAPQ","Server"),Object.defineProperty(o,"__esModule",{value:!0});var n=[["1","2","3","4","5","6","7","K","1","2","3","4","5","6","7"],["1","2","6","2","1","6","4","K","5","2","8","3","3","3","3"],["1","2","6","3","4","7","K","K","K","1","3","5","2","4","2"],["1","2","3","4","3","5","3","8","3","1","5","3","4","5","7"],["2","7","3","2","3","8","7","3","K","1","5","3","4","6","5"],["2","7","3","K","6","8","5","2","K","1","5","3","4","5","8"]],i=function(){function t(){this._dataRespondCallbacks=[]}return t.prototype.registerDataRespondEvent=function(t){this._dataRespondCallbacks.push(t)},t.prototype.requestSpinData=function(){var t=this,e=this._randomRange(100,1500)+(Math.random()>.8?2e3:0);window.setTimeout(function(){var e=t._randomRange(0,n.length-1,!0),o=[];Object.assign(o,n[e]),t._dataRespondCallbacks.forEach(function(t){t(o)})},e)},t.prototype._randomRange=function(t,e,o){void 0===o&&(o=!1);var n=e-t,i=t+Math.random()*n;return o&&(i=Math.round(i)),i},t}();o.default=i,cc._RF.pop()},{}],SlotMachine:[function(t,e,o){"use strict";cc._RF.push(e,"e7e493o9qBM3oCxrim/uikF","SlotMachine");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var p=t.length-1;p>=0;p--)(i=t[p])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./GameConfig"),p=t("./Reel"),c=cc._decorator,a=c.ccclass,l=c.property,u=function(){function t(){this.delayTimeToSpin=0}return r([l()],t.prototype,"delayTimeToSpin",void 0),r([a("ReelConfig")],t)}(),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.reelLayout=null,e.loadingNode=null,e.reelPrefab=null,e.reelConfig=[],e.reels=[],e.isLoadingBundle=!1,e.symbolSpriteFrameCollection={},e.isStarted=!1,e}var o;return i(e,t),o=e,e.getInstance=function(){return this.inst},e.prototype.onLoad=function(){var t=this;o.inst=this,this.reelLayout.node.opacity=0,this.loadSymbolAssetBundle(function(){t.createReelNodes(),cc.tween(t.reelLayout.node).to(.25,{opacity:255}).start(),cc.tween(t.loadingNode).to(.25,{opacity:0}).start(),cc.systemEvent.emit(s.GAME_EVENT.READY)}),cc.systemEvent.on(s.GAME_EVENT.SPIN,this.onSpin.bind(this),this),cc.systemEvent.on(s.GAME_EVENT.STOP,this.onBeginToStop.bind(this),this)},e.prototype.loadSymbolAssetBundle=function(t){var e=this;this.isLoadingBundle=!0,cc.assetManager.loadBundle(s.SYMBOLS_BUNBLE_NAME,function(o,n){if(o)return alert("Error while loading symbol bundle, please retry later."),void location.reload();n.loadDir("/",cc.SpriteFrame,function(o,n){n.forEach(function(t){e.symbolSpriteFrameCollection[t.name]=t}),e.isLoadingBundle=!1,t&&t()})})},e.prototype.maxReels=function(){return this.reelConfig.length},e.prototype.createReelNodes=function(){for(var t=0;t<this.maxReels();t++){var e=cc.instantiate(this.reelPrefab);e.parent=this.reelLayout.node;var o=e.getComponent(p.default);o.delayToSpinTime=this.reelConfig[t].delayTimeToSpin,o.setReelIndex(t),this.reels.push(o)}this.reelLayout.updateLayout()},e.prototype.getSymbolSprite=function(t){return this.symbolSpriteFrameCollection[t]},e.prototype.onSpin=function(){this.reels.forEach(function(t){return t.startSpin()}),this.isStarted=!0},e.prototype.onReelFinish=function(){},e.prototype.onBeginToStop=function(t){var e=this;this.reels.forEach(function(o){o.stop(e.getSymbolsForReel(t,o.reelIndex))})},e.prototype.getSymbolsForReel=function(t,e){for(var o=this.maxReels(),n=[],i=0;i<3;i++)n.push(t[e+i*o]);return n.push("Random"),n},e.prototype.update=function(){this.updateStop()},e.prototype.updateStop=function(){this.isStarted&&this.reels.every(function(t){return!t.isBusy()})&&(cc.systemEvent.emit(s.GAME_EVENT.FINISH),this.isStarted=!1)},e.prototype.isBusy=function(){return this.isLoadingBundle},e.inst=null,r([l(cc.Layout)],e.prototype,"reelLayout",void 0),r([l(cc.Node)],e.prototype,"loadingNode",void 0),r([l(cc.Prefab)],e.prototype,"reelPrefab",void 0),r([l([u])],e.prototype,"reelConfig",void 0),o=r([a],e)}(cc.Component);o.default=f,cc._RF.pop()},{"./GameConfig":"GameConfig","./Reel":"Reel"}],Symbol:[function(t,e,o){"use strict";cc._RF.push(e,"cc515vj51VMN4B/g172SKXs","Symbol");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var p=t.length-1;p>=0;p--)(i=t[p])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./GameConfig"),p=t("./SlotMachine"),c=cc._decorator,a=c.ccclass,l=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.isBlur=!1,e.normalSpriteFrame=null,e.blurSpriteFrame=null,e}return i(e,t),e.prototype.getBlur=function(){return this.isBlur},e.prototype.setBlur=function(t){this.sprite.spriteFrame=t?this.blurSpriteFrame:this.normalSpriteFrame,this.isBlur=t},e.prototype.setSymbol=function(t){if("Random"===t)return this.setRandomSymbol(!1);var e=p.default.getInstance();this.normalSpriteFrame=e.getSymbolSprite("symbol_"+t),this.blurSpriteFrame=e.getSymbolSprite("symbol_"+t+"_blur")},e.prototype.setRandomSymbol=function(t){this.setSymbol(this.randomSymbol()),this.setBlur(t)},e.prototype.randomSymbol=function(){return s.AVAILABLE_SYMBOLS[Math.floor(Math.random()*s.AVAILABLE_SYMBOLS.length)]},r([l(cc.Sprite)],e.prototype,"sprite",void 0),r([a],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./GameConfig":"GameConfig","./SlotMachine":"SlotMachine"}]},{},["GameConfig","GameManager","Reel","Server","SlotMachine","Symbol"]);